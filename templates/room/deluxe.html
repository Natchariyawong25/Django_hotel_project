{% extends "index.html" %}

{% load static %}

{% block title %}Suite room{% endblock %}

{% block script %}
<script src="{% static 'js/deluxe.js' %}"></script>
{% endblock %}

{% block start %}
<div class="collapse navbar-collapse" id="mainNavBar">
  <div class="col-md-6">
    <ul class="nav navbar-nav navbar-lelf">
      <li><a href="{% url "index" %}"><span class="glyphicon glyphicon-calendar"></span> &nbsp; Check Status Room</a>
      </li>
      <li><a href="{% url "reserve" %}"><span class="glyphicon glyphicon-briefcase"></span> &nbsp; Reservation</a></li>
      <li><a href="{% url "total_payment" %}"><span class="glyphicon glyphicon-shopping-cart"></span> &nbsp; Cart</a>
      </li>
    </ul>
  </div>
</div>
</div>

<div class="container" style="padding-bottom: 18px;font-size : 18px;">
  <div class="row">
    <div class="col-lg-8">
      <b>
        <h2>The Deluxe Room - Lay View Hotel</h2>
      </b>
      <span class="heading">Room Rating</span>
      <span class="fa fa-star checked" style="color: rgb(255, 235, 80);"></span>
      <span class="fa fa-star checked" style="color: rgb(255, 235, 80);"></span>
      <span class="fa fa-star checked" style="color: rgb(255, 235, 80);"></span>
      <span class="fa fa-star checked" style="color: rgb(255, 235, 80);"></span>
      <span class="fa fa-star checked" style="color: rgb(255, 235, 80);"></span>
      <p>5 average based on quality hotel award</p>
      <br />
      <div class="col-lg-4">
        <div class="row">
          <img src="{% static './img/deluxe/deluxe2.jpg' %}" width="250" height="150" />
          <br />
          <img src="{% static './img/deluxe/deluxe3.jpg' %}" width="250" height="150" />
        </div>
      </div>
      <div class="col-lg-4">
        <div class="row">
          <img src="{% static './img/deluxe/deluxe.jpg' %}" width="250" height="150" />
          <br />
          <img src="{% static './img/deluxe/deluxe1.jpg' %}" width="250" height="150" />
        </div>
      </div>
    </div>
    <div class="col-lg-3">
      <div class="row">
        <div></div>
        <div class="container">
          <form onSubmit="return validateForm();">
            <br />
            <div style="padding-bottom: 18px;font-size : 18px;">
              <div class="row">
                <div class="col-md-3">
                  <div style="padding-bottom: 12px;">Check-In date<span style="color: red;"> *</span><br />
                    <input type="text" id="data_6" name="check_in" style="max-width : 300px;" class="form-control"
                      placeholder="Fri Dec 11 2020" />
                  </div>

                </div>
                <div class="col-md-3">
                  <div style="padding-bottom: 12px;">Check-Out date<span style="color: red;"> *</span><br />
                    <input type="text" id="data_7" name="check_out" style="max-width : 300px;" class="form-control"
                      placeholder="Mon Dec 14 2020" />
                  </div>

                </div>
              </div>
              <div class="row">
                <div class="col-sm-2">
                  <div style="padding-bottom: 12px;">Number of adults<span style="color: red;"> *</span><br />
                    <input type="number" id="data_8" name="no_adult" min="0" style="max-width : 80px;"
                      class="form-control" value="0" required />
                  </div>
                </div>
                <div class="col-sm-2">
                  <div style="padding-bottom: 12px;">Number of children<span style="color: red;"> *</span><br />
                    <input type="number" id="data_9" name="no_child" min="0" style="max-width : 80px;"
                      class="form-control" value="0" required />
                  </div>
                </div>
                <div class="col-sm-2">
                  <div style="padding-bottom: 12px;">Number of room<span style="color: red;"> *</span><br />
                    <input id="txt_no_room" type="number" name="no_room" min="0" style="max-width :80px;"
                      class="form-control" value="0" required />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-2">
                  <div style="padding-bottom: 12px;">Room Price<br />
                    <input id="txt_roomprice" type="text" name="room_price" style="max-width :100px; font-size: 16px;"
                      class="form-control" value="0" placeholder="" readonly />
                  </div>
                </div>
                <div class="col-md-2">
                  <div style="padding-bottom: 12px;">Extra Facilities Price<br />
                    <input id="txt_exprice" type="text" name="data_12" style="max-width :100px; font-size: 16px;"
                      class="form-control" value="0" placeholder="" readonly />
                  </div>
                </div>
                <div class="col-md-2">
                  <div style="padding-bottom: 12px;">Total Price<br />
                    <input id="txt_totalprice" type="text" name="data_13" style="max-width :100px; font-size: 16px;"
                      class="form-control" value="0" placeholder="" readonly />
                  </div>
                </div>
              </div>
              <div>
                <a href="{% url "total_payment" %}"><button font-size: 2rem; padding:1%; class="btn btn-success"
                    type="submit" name="booking" value="Submit">
                    <span class="glyphicon glyphicon-booking"></span> &nbsp;Book Now!!!</button></a>
              </div>
            </div>
            <br />
            <div class="row">
              <div class="container">
                <h3>Additional Facilities</h3>
                <div class="row">
                  <div class="col-md-2">
                    <div style="display: inline;">
                      <input type="checkbox" id="exprice" value="false" name="extra_bed"
                        style="max-width :20px; max-height:20px; display: inline;" class="form-control" /> Extra bed
                    </div>
                  </div>
                  <div class="col-md-2">
                    <input type="text" id="txt_realexprice" name="extra_bed2"
                      style="max-width :100px; max-height:100px; padding-right:10px;" class="form-control"
                      placeholder="price" readonly />
                  </div>
                </div>
              </div>
            </div>
          </form>
          <script type="text/javascript">
            var today = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate());
            $('#data_6').datepicker({
              minDate: today,
              maxDate: function () {
                return $('#data_7').val();
              }
            });
            $('#data_7').datepicker({
              minDate: function () {
                return $('#data_6').val();
              }
            });
            function validateForm() {
              if (isEmpty(document.getElementById('data_6').value.trim())) {
                alert('Check-In date is required!');
                return false;
              }
              if (isEmpty(document.getElementById('data_7').value.trim())) {
                alert('Check-Out date is required!');
                return false;
              }
              if (isEmpty(document.getElementById('data_8').value.trim())) {
                alert('Number of adults is required!');
                return false;
              }
              if (isEmpty(document.getElementById('data_9').value.trim())) {
                alert('Number of children is required!');
                return false;
              }
              if (isEmpty(document.getElementById('txt_no_room').value.trim())) {
                alert('Number of room is required!');
                return false;
              }
              if ($('#txt_no_room').val() < 1) {
                alert('Number of room is required!');
                return false;
              }
              let date1 = new Date($('#data_6').val())
              let date2 = new Date($('#data_7').val())
              console.log($('#data_6').val())
              let formdata = {
                'check_in': $('#data_6').val(),
                'check_out': $('#data_7').val(),
                'no_adult': $('#data_8').val(),
                'no_child': $('#data_9').val(),
                'no_room': $('#txt_no_room').val(),
                'extra_bed': $('#exprice').is(':checked'),
                'total_price': $('#txt_totalprice').val(),
                'room_type': 'deluxe'
              }
              $.ajax({
                url: '/roomtype/detail/' + 'deluxe',
                type: 'get',
                dataType: 'json',
                success: function (data) {

                  $.ajax({
                    url: '/reserve/list',
                    type: 'get',
                    dataType: 'json',
                    success: function (data) {



                      let singleArr = [];

                      for (let i = 0; i < data.reservation.length; i++) {
                        if (data.reservation[i].room_type_id === 'deluxe') {
                          singleArr.push(data.reservation[i])
                        }
                      }
                      let singleCount = 0;
                      for (let i = 0; i < singleArr.length; i++) {
                        let cd1 = new Date(singleArr[i].check_in);
                        let cd2 = new Date(singleArr[i].check_out);
                        if (cd1 > date2 || cd2 < date1) {
                          singleCount += 1;
                        }
                      }
                      singleCount = singleArr.length - singleCount;
                      $.ajax({
                        url: '/roomtype/detail/' + 'deluxe',
                        type: 'get',
                        dataType: 'json',
                        success: function (data) {

                          if (data.roomtype.number - singleCount === 0) {
                            alert('Room Full')
                            return false
                          }
                        },
                        error: function (xhr, status, error) {
                          console.log(error)
                        }
                      });





                    },
                    error: function (xhr, status, error) {
                      console.log(error)
                    }
                  })
                }
              });

              $.ajax({
                url: '/reserve/create',
                type: 'post',
                dataType: 'json',
                data: formdata,
                success: function (data) {
                  console.log(data)


                  alert('Bookings Success!!');
                  window.location.href = '/';
                }, error: function (xhr, status, error) {
                  console.log(error)
                  alert('Bookings Failed4!!');
                }
              });


              return false;
            }
            function isEmpty(str) { return (str.length === 0 || !str.trim()); }
          </script>
        </div>
      </div>



    </div>

  </div>
</div>
<div class="container" style="font-size: 18px;">
  <b>
    <h3>Room Information</h3>
  </b>
  <div class="row">
    <div class="col-md-4">
      <dl>
        <h4>
          <dt><span class="fa fa-bed"></span> Room Features : </dt>
        </h4>
        <dd>- Individual climate control</dd>
        <dd>- Tea and coffee making facilities</dd>
        <dd>- 220V/240V electrical sockets</dd>
      </dl>
    </div>
    <div class="col-md-4">
      <dl>
        <h4>
          <dt><span class="fa fa-gamepad "></span> Entertainment :</dt>
        </h4>
        <dd>- LCD TV </dd>
        <dd>- International calls by operator</dd>
        <dd>- Relax zone</dd>
      </dl>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4">
      <dl>
        <h4>
          <dt><span class="fa fa-bath"></span> Bathroom Facilities :</dt>
        </h4>
        <dd>- Shower </dd>
        <dd>- Hair-dryer</dd>
      </dl>
    </div>
    <div class="row">
      <div class="col-md-4">
        <dl>
          <h4>
            <dt><span class="fa fa-rss"></span> Communication & Technology :</dt>
          </h4>
          <dd>- Free WiFi </dd>
          <dd>- International calls by operator</dd>
        </dl>
      </div>
    </div>
  </div>
  <script src="{% static 'js/deluxe.js' %}"></script>
</div>
{% endblock start %}